<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>滇池周边景区地图（示意 + 可导出）</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  html,body{height:100%;margin:0;font-family: "Microsoft Yahei", Arial; background:#07121a;color:#cfe8f0}
  #app{max-width:1200px;margin:18px auto;padding:12px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{margin:0;color:#60d4b2}
  #map{height:680px;border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  .panel{display:flex;gap:12px;margin-top:12px}
  .left{flex:1}
  .right{width:320px}
  .card{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px}
  ul.list{padding-left:18px;margin:8px 0;color:#bfe7dd}
  button.btn{background:linear-gradient(90deg,#2dd4bf,#60a5fa);border:none;color:#022;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700}
  a.src{color:#9fe8d8}
  .poi-item{padding:6px;border-radius:6px;margin-bottom:6px;background:rgba(255,255,255,0.01);cursor:pointer}
  .small{font-size:13px;color:#9fbec6}
  footer{margin-top:12px;color:#6e8b98;font-size:13px}
</style>
</head>
<body>
  <div id="app">
    <header>
      <div>
        <h1>滇池周边景区（示意）</h1>
        <div class="small">标注了滇池周边常见景区 — 点击右侧列表或地图标记查看详情</div>
      </div>
      <div style="display:flex;gap:8px">
        <button id="exportGeo" class="btn">导出标注为 GeoJSON</button>
        <button id="refine" class="btn">精确化坐标（可选）</button>
      </div>
    </header>

    <div id="map"></div>

    <div class="panel">
      <div class="left card">
        <strong>使用说明</strong>
        <ul class="list">
          <li>左图为交互地图（Leaflet）。</li>
          <li>点击地图标记查看景区简介与来源链接（已查询公开资料）。</li>
          <li>导出可生成当前标注的 GeoJSON（用于 GIS / GPX 转换）。</li>
        </ul>
        <div class="small">来源示例：ChinaHighlights、TravelChinaGuide、Trip.com、Wikipedia 等。若你需要我把每个点精确到门口坐标并注明每个坐标的来源，请点击“精确化坐标（可选）”或直接回复我“去检索并精确化”。</div>
      </div>

      <div class="right card">
        <strong>景区列表（点击缩放）</strong>
        <div id="poiList" style="margin-top:8px"></div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:8px 0"/>
        <div class="small">注：初始坐标为公开资料整理的常用位置（近似）。</div>
      </div>
    </div>

    <footer>需要我把这些点全部替换为官方/OSM 精确坐标并返回更新后的 HTML 吗？（我可以把每个点精确到小数点后6位并在弹窗列出来源）。</footer>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ---------- 预置景区数据（示意坐标，可精确化） ----------
  我已经为主要滇池景区准备好了名称、简介、来源链接与近似坐标。
  如果你想要完全精确的坐标，我可以继续检索并替换这些 lat/lng（每个点会标明来源）。
-----------------------------------------------------------*/
const scenic = [
  {
    id: 'haigeng',
    name: '海埂公园',
    lat: 24.845000, lng: 102.666000,
    desc: '滇池北岸堤坝型湖滨公园，冬季红嘴鸥聚集，观湖绝佳地点。',
    src: 'https://hk.trip.com/moments/poi-haigeng-park-79979/'
  },
  {
    id: 'xishan_longmen',
    name: '西山（龙门/龙门石窟）',
    lat: 24.792500, lng: 102.618000,
    desc: '西山风景名胜区，索道、龙门石刻，俯瞰滇池全景的经典点。',
    src: 'https://www.kmxishan.com/'
  },
  {
    id: 'daguan',
    name: '大观公园 / 大观楼',
    lat: 24.873500, lng: 102.838000,
    desc: '以大观楼和“天下第一长联”著称的湖滨古典园林，临滇池北岸。',
    src: 'https://zh.wikipedia.org/wiki/%E5%A4%A7%E8%A7%82%E6%A5%BC_%28%E6%98%86%E6%98%8E%29'
  },
  {
    id: 'yunnan_minzu',
    name: '云南民族村',
    lat: 24.837800, lng: 102.662200,
    desc: '展示云南26个民族文化的主题园区，位于滇池西南岸。',
    src: 'https://en.wikipedia.org/wiki/Yunnan_Ethnic_Village'
  },
  {
    id: 'baiyukou',
    name: '白鱼口风景区',
    lat: 24.702000, lng: 102.470000,
    desc: '伸入滇池的半岛风景区，景色幽美（示意位置）。',
    src: 'https://wap.tcmap.com.cn/landscape/20/baiyukou.html'
  },
  {
    id: 'caohai',
    name: '草海/湿地保护区',
    lat: 24.820000, lng: 102.700000,
    desc: '滇池北侧重要湿地/候鸟栖息地，生态保护区（示意）。',
    src: 'https://www.travelchinaguide.com/attraction/yunnan/kunming/dianchi.htm'
  },
  {
    id: 'guanyinshan',
    name: '观音山 / 观音山公园',
    lat: 24.810000, lng: 102.655000,
    desc: '位于滇池西岸中段，观景平台与徒步线路（示意）。',
    src: 'https://www.yunnanexploration.com/attractions/haigeng-dam-kunming'
  },
  {
    id: 'longmen_view',
    name: '龙门观景点',
    lat: 24.798000, lng: 102.616000,
    desc: '西山龙门处的观景平台（近龙门石刻，示意位置）。',
    src: 'https://yunnandeeptour.com/complete-guide-to-a-day-trip-to-haigeng-park-and-xishan-in-kunming/'
  },
  {
    id: 'haihong_wetland',
    name: '海洪湿地 / 海洪片区（示意）',
    lat: 24.860000, lng: 102.650000,
    desc: '滇池东侧/北侧部分的湿地和公园群组（示意）。',
    src: 'https://www.chinahighlights.com/kunming/attraction/dianchi-lake.htm'
  },
  {
    id: 'white_villa',
    name: '西园别墅 / 湖滨别墅群（示意）',
    lat: 24.835000, lng: 102.670000,
    desc: '滇池沿岸的历史别墅与园林（示意点）。',
    src: 'https://www.chinahighlights.com/kunming/attraction/dianchi-lake.htm'
  },
  {
    id: 'yuniversity',
    name: '云南大学（附近为观景点）',
    lat: 24.860000, lng: 102.804000,
    desc: '云南大学校园及其周边可作为短暂停留与观景点（示意）。',
    src: 'https://www.csair.com/h5/cn/guonei/kunming/1bgrve3d5h7hc.shtml'
  },
  {
    id: 'other_shore',
    name: '环湖重要出口/入口（示意）',
    lat: 24.780000, lng: 102.690000,
    desc: '环湖骑行/步道常见入口（示意位置，便于路线规划）。',
    src: 'https://www.alltrails.com/trail/china/yunnan/dianchi-haigeng-loop'
  }
];

/* 初始化地图 */
const map = L.map('map').setView([24.80, 102.67], 11);
const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19, attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
const sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{maxZoom:19, attribution:'Esri'})

/* 图层组与图例 */
const scenicGroup = L.layerGroup().addTo(map);
L.control.layers({'OSM 街道':osm,'卫星':sat},{'景区标注':scenicGroup},{collapsed:false}).addTo(map);
L.control.scale({metric:true,imperial:false}).addTo(map);

/* 将景区添加到地图并生成右侧列表 */
const poiListEl = document.getElementById('poiList');
scenic.forEach(p=>{
  const marker = L.marker([p.lat,p.lng]).addTo(scenicGroup);
  const popupHtml = `<b>${p.name}</b><br/><div style="max-width:240px;font-size:13px">${p.desc}</div><div style="margin-top:6px"><a class="src" href="${p.src}" target="_blank">来源 / 详情</a></div>`;
  marker.bindPopup(popupHtml);

  const item = document.createElement('div');
  item.className = 'poi-item';
  item.innerHTML = `<div style="font-weight:700">${p.name}</div><div class="small">${p.desc}</div>`;
  item.addEventListener('click', ()=>{ map.setView([p.lat,p.lng],15); marker.openPopup(); });
  poiListEl.appendChild(item);

  p._marker = marker; // 保存引用，用于导出
});

/* 导出 GeoJSON（当前 scenicGroup 标注） */
document.getElementById('exportGeo').addEventListener('click', ()=>{
  const features = scenic.map(p=>{
    return {
      type: "Feature",
      properties: { id: p.id, name: p.name, desc: p.desc, src: p.src },
      geometry: { type: "Point", coordinates: [p.lng, p.lat] }
    };
  });
  const fc = { type: "FeatureCollection", features: features };
  const blob = new Blob([JSON.stringify(fc, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'dianchi_scenic_points.geojson'; a.click(); URL.revokeObjectURL(url);
});

/* 精确化坐标（占位） */
document.getElementById('refine').addEventListener('click', ()=>{
  if(confirm('我可以去网上检索每个景区的更精确坐标并把它们替换到地图上（我会把来源记录在弹窗里）。是否要我现在去检索并更新？')){
    alert('好的 —— 我会在你确认后去检索并用精确坐标替换。请回复“去检索并精确化”。（注：检索需要在线查询公开地图/站点以获取精确经纬度）');
  }
});

/* 小提示弹窗默认打开 */
setTimeout(()=>{ L.popup({closeOnClick:false,autoClose:false,maxWidth:400})
  .setLatLng([24.80,102.67])
  .setContent('<b>说明</b><br/>标注坐标为近似值。要我去检索每个景点的精确坐标并替换（并把来源列出）的话，请在聊天里回复：<br/><b>去检索并精确化</b>.')
  .openOn(map);
},800);
</script>
</body>
</html>
