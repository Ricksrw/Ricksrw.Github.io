<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>杜瑞跑酷 - 不要撞上消防栓</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        body {
            font-family: 'Arial Rounded MT Bold', 'Helvetica', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 100vh;
            max-height: 600px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }
        
        canvas {
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 20px;
        }
        
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            text-align: center;
            border-radius: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out;
            padding: 20px;
            z-index: 100;
        }
        
        .screen.active {
            opacity: 1;
            pointer-events: all;
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0 #000, 1px 1px 5px rgba(0,0,0,0.8);
            color: #FF5722;
            background: linear-gradient(to right, #FF5722, #FF9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        h2 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #FF9800;
            text-shadow: 2px 2px 0 #000, 1px 1px 3px rgba(0,0,0,0.8);
            font-weight: bold;
        }
        
        p {
            font-size: 1.5rem;
            margin-bottom: 20px;
            max-width: 90%;
            text-shadow: 1px 1px 0 #000, 1px 1px 3px rgba(0,0,0,0.8);
            line-height: 1.5;
            font-weight: 500;
        }
        
        .button {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: linear-gradient(to bottom, #FF5722, #E64A19);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 30px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            pointer-events: auto;
            text-shadow: 1px 1px 0 #000;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .button:hover {
            background: linear-gradient(to bottom, #FF9800, #F57C00);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        #score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 24px;
            border-radius: 50px;
            pointer-events: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.8);
            border: 2px solid rgba(0, 0, 0, 0.1);
        }
        
        .controls {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 20px;
            pointer-events: none;
            z-index: 10;
        }
        
        .control-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(to bottom, rgba(255, 87, 34, 0.9), rgba(230, 74, 25, 0.9));
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            pointer-events: auto;
            user-select: none;
            text-shadow: 1px 1px 0 #000;
            border: 3px solid rgba(255, 255, 255, 0.5);
            transition: transform 0.1s;
        }
        
        .control-btn:active {
            background: linear-gradient(to bottom, rgba(255, 152, 0, 0.9), rgba(245, 124, 0, 0.9));
            transform: scale(0.95);
        }
        
        #instructions {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #BBDEFB;
            text-shadow: 1px 1px 0 #000;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.8rem;
            }
            
            h2 {
                font-size: 2rem;
            }
            
            p {
                font-size: 1.2rem;
            }
            
            .button {
                font-size: 1.2rem;
                padding: 12px 30px;
            }
            
            #score-display {
                font-size: 1.5rem;
                top: 15px;
                left: 15px;
                padding: 10px 20px;
            }
            
            .control-btn {
                width: 70px;
                height: 70px;
                font-size: 35px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2.2rem;
            }
            
            h2 {
                font-size: 1.8rem;
            }
            
            p {
                font-size: 1rem;
            }
            
            .button {
                font-size: 1rem;
                padding: 10px 25px;
            }
            
            #score-display {
                font-size: 1.2rem;
                top: 10px;
                left: 10px;
                padding: 8px 16px;
            }
            
            .control-btn {
                width: 60px;
                height: 60px;
                font-size: 30px;
            }
            
            .controls {
                bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <div id="ui-layer">
            <div id="score-display">得分: 0</div>
            
            <div id="start-screen" class="screen active">
                <h1>杜瑞跑酷</h1>
                <p>控制杜瑞躲避消防栓！不要撞上！</p>
                <p>蔡是蔡依林的蔡，颐是颐和园的颐，城是城市的城</p>
                <button class="button" id="start-button">开始游戏</button>
                <div id="instructions">
                    ← 向左移动 | 向右移动 →
                </div>
            </div>
            
            <div id="game-over-screen" class="screen">
                <h2>哎呀！杜瑞撞上消防栓了！</h2>
                <p>杜瑞被紧急送往医院治疗...</p>
                <p>最终得分: <span id="final-score">0</span></p>
                <button class="button" id="restart-button">重新开始</button>
            </div>
            
            <div class="controls">
                <div class="control-btn" id="left-btn">←</div>
                <div class="control-btn" id="right-btn">→</div>
            </div>
        </div>
    </div>

    <script>
        // 游戏变量
        let canvas, ctx;
        let player;
        let hydrants = [];
        let score = 0;
        let gameActive = false;
        let gameSpeed = 3;
        let spawnRate = 60;
        let frameCount = 0;
        let lanes = [];
        let canvasWidth, canvasHeight;
        let lastTimestamp = 0;
        
        // 初始化游戏
        function initGame() {
            setupCanvas();
            
            // 初始化玩家
            player = {
                x: canvasWidth / 2,
                y: canvasHeight - 100,
                width: 70,
                height: 90,
                lane: 1,
                color: '#4CAF50',
                name: '杜瑞'
            };
            
            // 设置车道位置
            lanes = [
                canvasWidth * 0.25,
                canvasWidth * 0.5,
                canvasWidth * 0.75
            ];
            
            // 重置游戏状态
            hydrants = [];
            score = 0;
            gameActive = true;
            gameSpeed = 3;
            spawnRate = 60;
            frameCount = 0;
            lastTimestamp = 0;
            
            // 更新分数显示
            document.getElementById('score-display').textContent = `得分: ${score}`;
            
            // 隐藏开始界面，显示游戏
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('game-over-screen').classList.remove('active');
            
            // 开始游戏循环
            requestAnimationFrame(gameLoop);
        }
        
        // 设置Canvas尺寸
        function setupCanvas() {
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            
            // 设置Canvas大小为容器大小
            const container = document.getElementById('game-container');
            canvasWidth = canvas.width = container.clientWidth;
            canvasHeight = canvas.height = container.clientHeight;
        }
        
        // 游戏主循环
        function gameLoop(timestamp) {
            if (!gameActive) return;
            
            // 计算时间增量，确保平滑动画
            const deltaTime = timestamp - lastTimestamp;
            lastTimestamp = timestamp;
            
            // 限制帧率，减少闪烁
            if (deltaTime < 16) { // 约60fps
                requestAnimationFrame(gameLoop);
                return;
            }
            
            // 清除画布
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            // 绘制背景
            drawBackground();
            
            // 更新和绘制消防栓
            updateHydrants();
            
            // 绘制玩家
            drawPlayer();
            
            // 生成新的消防栓
            frameCount++;
            if (frameCount % spawnRate === 0) {
                spawnHydrant();
                // 随着游戏进行，增加难度
                if (spawnRate > 20) spawnRate -= 0.5;
                if (gameSpeed < 8) gameSpeed += 0.05;
            }
            
            // 增加分数
            score++;
            document.getElementById('score-display').textContent = `得分: ${score}`;
            
            // 继续循环
            requestAnimationFrame(gameLoop);
        }
        
        // 绘制背景
        function drawBackground() {
            // 绘制天空
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(1, '#E0F7FA');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // 绘制道路
            const roadWidth = canvasWidth * 0.8;
            const roadX = (canvasWidth - roadWidth) / 2;
            ctx.fillStyle = '#424242';
            ctx.fillRect(roadX, 0, roadWidth, canvasHeight);
            
            // 绘制车道分隔线
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 5;
            ctx.setLineDash([20, 30]);
            
            ctx.beginPath();
            ctx.moveTo(roadX + roadWidth * 1/3, 0);
            ctx.lineTo(roadX + roadWidth * 1/3, canvasHeight);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(roadX + roadWidth * 2/3, 0);
            ctx.lineTo(roadX + roadWidth * 2/3, canvasHeight);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // 绘制草地
            ctx.fillStyle = '#388E3C';
            ctx.fillRect(0, 0, roadX, canvasHeight);
            ctx.fillRect(roadX + roadWidth, 0, roadX, canvasHeight);
            
            // 绘制远处建筑物
            ctx.fillStyle = '#78909C';
            for (let i = 0; i < 5; i++) {
                const buildingHeight = 80 + Math.random() * 100;
                ctx.fillRect(roadX + 50 + i * 150, canvasHeight - buildingHeight, 80, buildingHeight);
                
                // 绘制窗户
                ctx.fillStyle = '#FFD600';
                for (let j = 0; j < 4; j++) {
                    for (let k = 0; k < 4; k++) {
                        ctx.fillRect(roadX + 60 + i * 150 + j * 20, canvasHeight - buildingHeight + 20 + k * 25, 10, 15);
                    }
                }
                ctx.fillStyle = '#78909C';
            }
        }
        
        // 绘制玩家
        function drawPlayer() {
            // 绘制玩家身体
            ctx.fillStyle = player.color;
            ctx.beginPath();
            roundRect(ctx, player.x - player.width/2, player.y - player.height/2, player.width, player.height, 10);
            ctx.fill();
            
            // 绘制玩家头部
            ctx.fillStyle = '#FFCCBC';
            ctx.beginPath();
            ctx.arc(player.x, player.y - player.height/2, 20, 0, Math.PI * 2);
            ctx.fill();
            
            // 绘制眼睛
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(player.x - 8, player.y - player.height/2 - 2, 4, 0, Math.PI * 2);
            ctx.arc(player.x + 8, player.y - player.height/2 - 2, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // 绘制嘴巴
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(player.x, player.y - player.height/2 + 8, 8, 0.2 * Math.PI, 0.8 * Math.PI);
            ctx.stroke();
            
            // 绘制手臂和腿
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x - player.width/2 - 10, player.y - player.height/2 + 15, 10, 30);
            ctx.fillRect(player.x + player.width/2, player.y - player.height/2 + 15, 10, 30);
            ctx.fillRect(player.x - player.width/2, player.y + player.height/2 - 20, 15, 30);
            ctx.fillRect(player.x + player.width/2 - 15, player.y + player.height/2 - 20, 15, 30);
            
            // 在身体上绘制名字"蔡颐城"
            ctx.font = 'bold 18px "Microsoft YaHei", Arial, sans-serif';
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.name, player.x, player.y - 5);
            
            // 添加名字阴影效果
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.strokeText(player.name, player.x, player.y - 5);
        }
        
        // 生成消防栓
        function spawnHydrant() {
            const lane = Math.floor(Math.random() * lanes.length);
            
            hydrants.push({
                x: lanes[lane],
                y: -50,
                width: 50,
                height: 70,
                speed: gameSpeed,
                color: '#FF5722'
            });
        }
        
        // 更新消防栓位置
        function updateHydrants() {
            for (let i = hydrants.length - 1; i >= 0; i--) {
                const hydrant = hydrants[i];
                
                // 更新位置
                hydrant.y += hydrant.speed;
                
                // 绘制消防栓
                drawHydrant(hydrant);
                
                // 检测碰撞
                if (isColliding(player, hydrant)) {
                    gameOver();
                    return;
                }
                
                // 移除超出屏幕的消防栓
                if (hydrant.y > canvasHeight + 100) {
                    hydrants.splice(i, 1);
                }
            }
        }
        
        // 绘制精致的消防栓
        function drawHydrant(hydrant) {
            const {x, y, width, height} = hydrant;
            
            // 消防栓主体
            ctx.fillStyle = '#D32F2F';
            ctx.beginPath();
            roundRect(ctx, x - width/2, y - height/2, width, height * 0.8, 10);
            ctx.fill();
            
            // 消防栓顶部
            ctx.fillStyle = '#FFC107';
            ctx.beginPath();
            ctx.arc(x, y - height/2, width/2, 0, Math.PI * 2);
            ctx.fill();
            
            // 顶部细节
            ctx.fillStyle = '#FFA000';
            ctx.beginPath();
            ctx.arc(x, y - height/2, width/3, 0, Math.PI * 2);
            ctx.fill();
            
            // 消防栓接口
            ctx.fillStyle = '#757575';
            ctx.beginPath();
            ctx.arc(x, y - height/2, width/6, 0, Math.PI * 2);
            ctx.fill();
            
            // 消防栓侧面接口
            ctx.fillStyle = '#9E9E9E';
            ctx.beginPath();
            ctx.arc(x - width/2, y - height/4, width/5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(x + width/2, y - height/4, width/5, 0, Math.PI * 2);
            ctx.fill();
            
            // 添加高光
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.beginPath();
            ctx.arc(x - width/4, y - height/2 + 5, width/8, 0, Math.PI * 2);
            ctx.fill();
            
            // 添加阴影
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.beginPath();
            ctx.arc(x + width/4, y - height/2 + 5, width/8, 0, Math.PI * 2);
            ctx.fill();
            
            // 底座
            ctx.fillStyle = '#9E9E9E';
            ctx.beginPath();
            roundRect(ctx, x - width/2 - 5, y + height/2 - 10, width + 10, 10, 5);
            ctx.fill();
            
            // 添加反光效果
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            ctx.moveTo(x - width/2, y - height/2);
            ctx.lineTo(x - width/2, y + height/2 - 10);
            ctx.lineTo(x - width/4, y + height/2 - 10);
            ctx.lineTo(x - width/4, y - height/2);
            ctx.closePath();
            ctx.fill();
        }
        
        // 碰撞检测
        function isColliding(obj1, obj2) {
            return obj1.x - obj1.width/2 < obj2.x + obj2.width/2 &&
                   obj1.x + obj1.width/2 > obj2.x - obj2.width/2 &&
                   obj1.y - obj1.height/2 < obj2.y + obj2.height/2 &&
                   obj1.y + obj1.height/2 > obj2.y - obj2.height/2;
        }
        
        // 游戏结束
        function gameOver() {
            gameActive = false;
            document.getElementById('final-score').textContent = score;
            document.getElementById('game-over-screen').classList.add('active');
        }
        
        // 移动玩家
        function movePlayer(direction) {
            if (!gameActive) return;
            
            if (direction === 'left' && player.lane > 0) {
                player.lane--;
            } else if (direction === 'right' && player.lane < lanes.length - 1) {
                player.lane++;
            }
            
            player.x = lanes[player.lane];
        }
        
        // 圆角矩形函数
        function roundRect(ctx, x, y, width, height, radius) {
            if (width < 2 * radius) radius = width / 2;
            if (height < 2 * radius) radius = height / 2;
            
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.arcTo(x + width, y, x + width, y + radius, radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
            ctx.lineTo(x + radius, y + height);
            ctx.arcTo(x, y + height, x, y + height - radius, radius);
            ctx.lineTo(x, y + radius);
            ctx.arcTo(x, y, x + radius, y, radius);
            ctx.closePath();
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    movePlayer('left');
                } else if (e.key === 'ArrowRight') {
                    movePlayer('right');
                }
            });
            
            document.getElementById('left-btn').addEventListener('click', () => {
                movePlayer('left');
            });
            
            document.getElementById('right-btn').addEventListener('click', () => {
                movePlayer('right');
            });
            
            document.getElementById('start-button').addEventListener('click', initGame);
            document.getElementById('restart-button').addEventListener('click', initGame);
        }
        
        // 初始化游戏
        function initializeGame() {
            // 添加圆角矩形支持
            if (!CanvasRenderingContext2D.prototype.roundRect) {
                CanvasRenderingContext2D.prototype.roundRect = roundRect;
            }
            
            setupCanvas();
            setupEventListeners();
            
            // 设置初始车道位置
            lanes = [
                canvasWidth * 0.25,
                canvasWidth * 0.5,
                canvasWidth * 0.75
            ];
        }
        
        // 页面加载完成后初始化游戏
        window.addEventListener('load', initializeGame);
        
        // 窗口大小变化时调整Canvas
        window.addEventListener('resize', () => {
            if (!gameActive) {
                setupCanvas();
                // 设置初始车道位置
                lanes = [
                    canvasWidth * 0.25,
                    canvasWidth * 0.5,
                    canvasWidth * 0.75
                ];
            }
        });
    </script>
</body>
</html>

